<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>

	<windowclass name="charsheet_main">
		<!-- <margins control="0,0,0,2" /> -->
		<sheetdata>
			<frame_char name="statsframe">
				<!-- <bounds>15,0,-29,-5</bounds> -->
				<!-- <bounds>15,0,-29,340</bounds> -->
				<bounds>28,10,-45,400</bounds>
			</frame_char>

			<frame_char name="weaponsframe">
				<!-- <bounds>15,340,-29,-5</bounds> -->
				<bounds>28,415,-45,-5</bounds>
			</frame_char>

			<!-- reposition class -->
			<string_labeled name="class" source="pcclass">
				<anchored to="statsframe" position="insidetopleft" offset="20,8" height="20">
					<right anchor="right" offset="-200" />
				</anchored>
				<labelres>char_label_class</labelres>
				<readonly />
				<script>
					function onDrop(x, y, draginfo)
						if draginfo.isType("shortcut") then
							local sClass, sRecord = draginfo.getShortcutData();
							local nodeChar = window.getDatabaseNode();
							if StringManager.contains({"pcclass"}, sClass) then
								CharManagerMothership.addClassDB(nodeChar, sClass, sRecord);
								return true;
							end
						end
					end			
				</script>
			</string_labeled>
		
			<!-- reposition pcclasslink -->
			<linkfield name="pcclasslink" source="pcclasslink">
				<anchored to="class" position="right" offset="28,0" width="20" />
				<description field="referencepcclass" />
				<closetoggle />
				<invisible />
				<script>
					function onInit()
						onValueChanged();
					end
					function onValueChanged()
						if isEmpty() then
							setVisible(false);
						else
							setVisible(true);
						end
					end
				</script>
			</linkfield>

			<string_label_inline name="stats_label">
				<!-- <anchored to="class" position="belowleft" offset="0,20" width="60" height="30" /> -->
				<anchored to="class" position="belowleft" offset="0,40" width="60" height="30" />
				<static textres="char_label_stats" />
				<default>STATS</default>
			</string_label_inline>		
			<number_charstat name="strength" source="stats.strength">
				<anchored>
					<left offset="0" />
				</anchored>
				<target>strength</target>
			</number_charstat>
			<label_abilityscore>
				<anchored to="strength" />
				<static textres="STRENGTH" />
			</label_abilityscore>
			<number_charstat name="speed" source="stats.speed">
				<target>speed</target>
			</number_charstat>
			<label_abilityscore>
				<anchored to="speed" />
				<static textres="SPEED" />
			</label_abilityscore>
			<number_charstat name="intellect" source="stats.intellect">
				<target>intellect</target>
			</number_charstat>
			<label_abilityscore>
				<anchored to="intellect" />
				<static textres="INTELLECT" />
			</label_abilityscore>
			<number_charstat name="combat" source="stats.combat">
				<target>combat</target>
			</number_charstat>
			<label_abilityscore>
				<anchored to="combat" />
				<static textres="COMBAT" />
			</label_abilityscore>

			<string_label_inline name="saves_label">
				<anchored to="stats_label" position="belowleft" offset="0,20" width="60" height="30" />
				<static textres="char_label_saves" />
				<default>SAVES</default>
			</string_label_inline>
			<number_charsave name="sanity" source="saves.sanity">
				<anchored>
					<left offset="0" />
				</anchored>
				<target>sanity</target>
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						local nodeChar = window.getDatabaseNode();
						DB.setValue(nodeChar, "saves.rest", "number", math.min(DB.getValue(nodeChar, "saves.body", 0), DB.getValue(nodeChar, "saves.fear", 0), DB.getValue(nodeChar, "saves.sanity", 0)));
					end
				</script>
			</number_charsave>
			<label_abilityscore>
				<anchored to="sanity" />
				<static textres="SANITY" />
			</label_abilityscore>
			<number_charsave name="fear" source="saves.fear">
				<target>fear</target>
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						local nodeChar = window.getDatabaseNode();
						DB.setValue(nodeChar, "saves.rest", "number", math.min(DB.getValue(nodeChar, "saves.body", 0), DB.getValue(nodeChar, "saves.fear", 0), DB.getValue(nodeChar, "saves.sanity", 0)));
					end
				</script>
			</number_charsave>
			<label_abilityscore>
				<anchored to="fear" />
				<static textres="FEAR" />
			</label_abilityscore>
			<number_charsave name="body" source="saves.body">
				<target>body</target>
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						local nodeChar = window.getDatabaseNode();
						DB.setValue(nodeChar, "saves.rest", "number", math.min(DB.getValue(nodeChar, "saves.body", 0), DB.getValue(nodeChar, "saves.fear", 0), DB.getValue(nodeChar, "saves.sanity", 0)));
					end
				</script>
			</number_charsave>
			<label_abilityscore>
				<anchored to="body" />
				<static textres="BODY" />
			</label_abilityscore>

			<string_label_inline name="stress_label">
				<anchored to="saves_label" position="belowleft" offset="0,20" width="60" height="30" />
				<static textres="char_label_stress" />
				<default>STRESS</default>
			</string_label_inline>
			<number_stress name="stress" source="stress">
				<anchored>
					<left offset="0" />
				</anchored>
				<default>2</default>
				<target>stress</target>
				<delaykeyupdate />
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						local minstress = DB.getValue(window.getDatabaseNode(), "minstress", 0);
						if getValue() &lt; minstress then
							--[[ setValue(minstress); ]]
							ChatManager.SystemMessage(Interface.getString("char_error_minstress"));
						elseif getValue() &gt; DataCommon.maxstress then
							--[[ setValue(DataCommon.maxstress); ]]
							ChatManager.SystemMessage(Interface.getString("char_error_maxstress"));
						end
					end
				</script>
			</number_stress>
			<label_abilityscore>
				<anchored to="stress" />
				<static textres="STRESS" />
			</label_abilityscore>
			<number_charstress name="minstress" source="minstress">
				<default>2</default>
				<target>minstress</target>
				<!-- <delaykeyupdate /> -->
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						local stress = DB.getValue(window.getDatabaseNode(), "stress", 0);
						if getValue() &gt; stress then
							ChatManager.SystemMessage(Interface.getString("char_error_minstress"));
						end
					end
				</script>
			</number_charstress>
			<label_abilityscore>
				<anchored to="minstress" />
				<static textres="MINSTRESS" />
			</label_abilityscore>
			<number_rest name="rest" source="saves.rest">
				<target>rest</target>
			</number_rest>
			<label_abilityscore>
				<anchored to="rest" />
				<static textres="REST" />
			</label_abilityscore>

			<!-- <button_checkbox name="safety"> -->
				<!-- <target>safety</target> -->
				<!-- <anchored to="stress_label" width="60" height="30"> -->
					<!-- <top anchor="top" /> -->
					<!-- <left anchor="right" relation="relative" offset="18" /> -->
				<!-- </anchored> -->
				<!-- <tooltip textres="char_safety_tooltip" /> -->
			<!-- </button_checkbox> -->
			<!-- <label_abilityscore> -->
				<!-- <anchored to="safety" /> -->
				<!-- <static textres="SAFETY" /> -->
			<!-- </label_abilityscore> -->

			<string_label_inline name="health_label">
				<anchored to="stress_label" position="belowleft" offset="0,20" width="60" height="30" />
				<static textres="char_label_health" />
				<default>HEALTH</default>
			</string_label_inline>
			<number_charhealth name="maxwounds" source="maxwounds">
				<anchored>
					<left offset="0" />
				</anchored>
				<default>2</default>
				<target>maxwounds</target>
			</number_charhealth>
			<label_abilityscore>
				<anchored to="maxwounds" />
				<static textres="MAXWOUNDS" />
			</label_abilityscore>
			<number_charhealth name="health" source="health">
				<target>health</target>
				<readonly />
			</number_charhealth>
			<label_abilityscore>
				<anchored to="health" />
				<static textres="HEALTH" />
			</label_abilityscore>
			<number_charhealth name="injury" source="injury">
				<target>injury</target>
			</number_charhealth>
			<label_abilityscore>
				<anchored to="injury" />
				<static textres="INJURY" />
			</label_abilityscore>
			<number_charhealth name="wounds" source="wounds">
				<target>wounds</target>
			</number_charhealth>
			<label_abilityscore>
				<anchored to="wounds" />
				<static textres="WOUNDS" />
			</label_abilityscore>
			<number_bleeding name="bleeding" source="bleeding">
				<target>bleeding</target>
			</number_bleeding>
			<label_abilityscore>
				<anchored to="bleeding" />
				<static textres="BLEEDING" />
			</label_abilityscore>

			<string_labeled name="traumaresponse" source="traumaresponse">
				<anchored to="health_label" position="belowleft" offset="0,20" width="400" />
				<labelres>char_label_traumaresponse</labelres>
				<multilinespacing>20</multilinespacing>
				<readonly />
				<script>
					function onInit()
						super.onInit();
						onValueChanged();
					end

					function onValueChanged()
						setVisible(getValue() ~= "");
					end

					function onDrop(x, y, draginfo)
						if draginfo.isType("shortcut") then
							local sClass, sRecord = draginfo.getShortcutData();
							local nodeChar = window.getDatabaseNode();
							if StringManager.contains({"pcclass"}, sClass) then
								CharManagerMothership.addClassTraumaResponse(nodeChar, sClass, sRecord);
								return true;
							end
						end
					end			
				</script>
			</string_labeled>
			
			<subwindow name="contents">
				<anchored to="weaponsframe" position="insidetopleft">
					<bottom offset="-15" />
					<top offset="15" />
					<left offset="0" />
					<right offset="-15" />
				</anchored>
				<class>charsheet_actions_contents</class>
				<activate />
				<fastinit />
			</subwindow>
			<scrollbar_charcontents />

		</sheetdata>
	</windowclass>

	<windowclass name="charsheet_actions_contents">
		<margins control="0,0,0,2" />
		<!-- <script> -->
			<!-- function onModeChanged() -->
				<!-- weapons.onModeChanged(); -->
			<!-- end -->
			
			<!-- function onDrop(x, y, draginfo) -->
				<!-- if draginfo.isType("shortcut") then -->
					<!-- local sClass, sRecord = draginfo.getShortcutData(); -->
					<!-- local nodeChar = getDatabaseNode(); -->
					<!-- if StringManager.contains({"reference_weapon"}, sClass) then -->
						<!-- return ItemManager.handleAnyDrop(nodeChar, draginfo); -->
					<!-- end -->
				<!-- end -->
			<!-- end			 -->
		<!-- </script> -->
		<sheetdata>
			<anchor_column name="columnanchor" />
			
			<list_charweapon name="weapons">
				<anchored>
					<top parent="columnanchor" anchor="bottom" relation="relative" offset="2" />
					<left offset="10" />
					<right offset="-5" />
				</anchored>
				<class>char_weapon</class>
				<noscroll />
			</list_charweapon>
		</sheetdata>
	</windowclass>

</root>
